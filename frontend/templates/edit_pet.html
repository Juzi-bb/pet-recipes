{% extends "base.html" %}

{% block title %}ç¼–è¾‘å® ç‰©ä¿¡æ¯ - å® ç‰©é£Ÿè°±ç½‘ç«™{% endblock %}

{% block content %}
<style>
    .edit-pet-container {
        max-width: 600px;
        margin: 0 auto;
        padding: 2rem;
    }

    .page-header {
        text-align: center;
        margin-bottom: 2rem;
    }

    .page-header h1 {
        color: #510B0B;
        font-size: 2rem;
        margin-bottom: 0.5rem;
    }

    .page-header p {
        color: #B82F0D;
        font-size: 1.1rem;
    }

    .form-container {
        background-color: white;
        padding: 2rem;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        border: 2px solid #A1B4B2;
    }

    .form-section {
        margin-bottom: 2rem;
    }

    .section-title {
        font-size: 1.2rem;
        color: #510B0B;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid #EDBF9D;
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        margin-bottom: 1.5rem;
    }

    .form-group {
        margin-bottom: 1.5rem;
    }

    .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: bold;
        color: #510B0B;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
        width: 100%;
        padding: 1rem;
        border: 2px solid #A1B4B2;
        border-radius: 8px;
        font-size: 1rem;
        transition: border-color 0.3s ease;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
        outline: none;
        border-color: #5580AD;
        box-shadow: 0 0 0 3px rgba(85, 128, 173, 0.1);
    }

    .form-help {
        font-size: 0.9rem;
        color: #B82F0D;
        margin-top: 0.5rem;
    }

    .checkbox-group {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 0.5rem;
        margin-top: 0.5rem;
    }

    .checkbox-item {
        display: flex;
        align-items: center;
        padding: 0.5rem;
        border: 1px solid #A1B4B2;
        border-radius: 6px;
        transition: all 0.3s ease;
    }

    .checkbox-item:hover {
        background-color: #f8f9fa;
    }

    .checkbox-item input[type="checkbox"] {
        margin-right: 0.5rem;
        width: auto;
    }

    .checkbox-item input[type="checkbox"]:checked + label {
        color: #510B0B;
        font-weight: bold;
    }

    .avatar-selector {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
    }

    .avatar-option {
        text-align: center;
        cursor: pointer;
        padding: 1rem;
        border: 2px solid #A1B4B2;
        border-radius: 12px;
        transition: all 0.3s ease;
    }

    .avatar-option:hover {
        border-color: #5580AD;
        background-color: #f8f9fa;
    }

    .avatar-option input[type="radio"] {
        display: none;
    }

    .avatar-option input[type="radio"]:checked + label {
        color: #510B0B;
        font-weight: bold;
    }

    .avatar-option input[type="radio"]:checked + label .avatar-img {
        border-color: #510B0B;
        box-shadow: 0 0 0 3px rgba(81, 11, 11, 0.2);
    }

    .avatar-img {
        width: 70px;
        height: 70px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid #A1B4B2;
        margin-bottom: 0.5rem;
        transition: all 0.3s ease;
    }

    .avatar-label {
        display: block;
        font-size: 0.9rem;
        cursor: pointer;
    }

    .submit-btn {
        width: 100%;
        padding: 1rem;
        background-color: #5580AD;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 1.1rem;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 1rem;
    }

    .submit-btn:hover {
        background-color: #A1B4B2;
        transform: translateY(-2px);
    }

    .back-link {
        display: inline-block;
        color: #5580AD;
        text-decoration: none;
        margin-bottom: 1rem;
        font-weight: bold;
    }

    .back-link:hover {
        color: #510B0B;
    }

    @media (max-width: 768px) {
        .form-row {
            grid-template-columns: 1fr;
        }
        
        .checkbox-group {
            grid-template-columns: 1fr;
        }
        
        .avatar-selector {
            grid-template-columns: repeat(4, 1fr);
        }
    }
</style>

<div class="edit-pet-container">
    <a href="{{ url_for('main.user_center') }}" class="back-link">â† è¿”å›ç”¨æˆ·ä¸­å¿ƒ</a>
    
    <div class="page-header">
        <h1>âœï¸ ç¼–è¾‘å® ç‰©ä¿¡æ¯</h1>
        <p>æ›´æ–°æ‚¨çˆ±å® çš„èµ„æ–™ï¼Œè·å¾—æ›´ç²¾å‡†çš„é£Ÿè°±æ¨è</p>
    </div>

    <div class="form-container">
        <form method="POST" action="{{ url_for('main.edit_pet', pet_id=pet.id) }}">
            <!-- åŸºæœ¬ä¿¡æ¯ -->
            <div class="form-section">
                <div class="section-title">ğŸ“‹ åŸºæœ¬ä¿¡æ¯</div>
                
                <div class="form-group">
                    <label for="name">
                        <span style="margin-right: 0.5rem;">ğŸ·ï¸</span>å® ç‰©åå­—
                    </label>
                    <input type="text" id="name" name="name" required maxlength="50" 
                        value="{{ pet.name }}" placeholder="è¯·è¾“å…¥å® ç‰©çš„åå­—">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="species">
                            <span style="margin-right: 0.5rem;">ğŸ•</span>å® ç‰©ç§ç±»
                        </label>
                        <select id="species" name="species" required>
                            <option value="">è¯·é€‰æ‹©ç§ç±»</option>
                            <option value="ç‹—" {{ 'selected' if pet.species == 'ç‹—' else '' }}>ç‹—</option>
                            <option value="çŒ«" {{ 'selected' if pet.species == 'çŒ«' else '' }}>çŒ«</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="breed">
                            <span style="margin-right: 0.5rem;">ğŸ“</span>å“ç§ï¼ˆå¯é€‰ï¼‰
                        </label>
                        <input type="text" id="breed" name="breed" maxlength="50" 
                            value="{{ pet.breed or '' }}" placeholder="å¦‚ï¼šé‡‘æ¯›ã€è‹±çŸ­ç­‰">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="weight">
                            <span style="margin-right: 0.5rem;">âš–ï¸</span>ä½“é‡ï¼ˆkgï¼‰
                        </label>
                        <input type="number" id="weight" name="weight" required 
                            min="0.5" max="80" step="0.1" value="{{ pet.weight }}" placeholder="è¯·è¾“å…¥ä½“é‡">
                        <div class="form-help">èŒƒå›´ï¼š0.5-80kg</div>
                    </div>

                    <div class="form-group">
                        <label for="age">
                            <span style="margin-right: 0.5rem;">ğŸ‚</span>å¹´é¾„ï¼ˆå²ï¼‰
                        </label>
                        <input type="number" id="age" name="age" required 
                            min="0" max="25" value="{{ pet.age }}" placeholder="è¯·è¾“å…¥å¹´é¾„">
                        <div class="form-help">èŒƒå›´ï¼š0-25å²</div>
                    </div>
                </div>
            </div>

            <!-- ç‰¹æ®Šéœ€æ±‚ -->
            <div class="form-section">
                <div class="section-title">ğŸ¥ ç‰¹æ®Šéœ€æ±‚</div>
                <div class="form-group">
                    <label>è¯·é€‰æ‹©æ‚¨å® ç‰©çš„ç‰¹æ®Šéœ€æ±‚ï¼ˆå¯å¤šé€‰ï¼‰ï¼š</label>
                    <div class="checkbox-group">
                        {% set current_needs = pet.special_needs.split(', ') if pet.special_needs else [] %}
                        <div class="checkbox-item">
                            <input type="checkbox" id="need_none" name="special_needs" value="æ— ç‰¹æ®Šéœ€æ±‚"
                                {{ 'checked' if 'æ— ç‰¹æ®Šéœ€æ±‚' in current_needs else '' }}>
                            <label for="need_none">æ— ç‰¹æ®Šéœ€æ±‚</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="need_seafood" name="special_needs" value="æµ·é²œè¿‡æ•"
                                {{ 'checked' if 'æµ·é²œè¿‡æ•' in current_needs else '' }}>
                            <label for="need_seafood">æµ·é²œè¿‡æ•</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="need_nuts" name="special_needs" value="åšæœè¿‡æ•"
                                {{ 'checked' if 'åšæœè¿‡æ•' in current_needs else '' }}>
                            <label for="need_nuts">åšæœè¿‡æ•</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="need_obesity" name="special_needs" value="è‚¥èƒ–"
                                {{ 'checked' if 'è‚¥èƒ–' in current_needs else '' }}>
                            <label for="need_obesity">è‚¥èƒ–</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="need_diabetes" name="special_needs" value="ç³–å°¿ç—…"
                                {{ 'checked' if 'ç³–å°¿ç—…' in current_needs else '' }}>
                            <label for="need_diabetes">ç³–å°¿ç—…</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="need_kidney" name="special_needs" value="è‚¾è„ç–¾ç—…"
                                {{ 'checked' if 'è‚¾è„ç–¾ç—…' in current_needs else '' }}>
                            <label for="need_kidney">è‚¾è„ç–¾ç—…</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="need_sensitive" name="special_needs" value="è‚ èƒƒæ•æ„Ÿ"
                                {{ 'checked' if 'è‚ èƒƒæ•æ„Ÿ' in current_needs else '' }}>
                            <label for="need_sensitive">è‚ èƒƒæ•æ„Ÿ</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="need_fur" name="special_needs" value="ç¾æ¯›éœ€æ±‚"
                                {{ 'checked' if 'ç¾æ¯›éœ€æ±‚' in current_needs else '' }}>
                            <label for="need_fur">ç¾æ¯›éœ€æ±‚</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="need_joint" name="special_needs" value="å…³èŠ‚é—®é¢˜"
                                {{ 'checked' if 'å…³èŠ‚é—®é¢˜' in current_needs else '' }}>
                            <label for="need_joint">å…³èŠ‚é—®é¢˜</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="need_dental" name="special_needs" value="ç‰™é½¿å¥åº·"
                                {{ 'checked' if 'ç‰™é½¿å¥åº·' in current_needs else '' }}>
                            <label for="need_dental">ç‰™é½¿å¥åº·</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <div class="section-title">âœ¨ é€‰æ‹©å¤´åƒ</div>
                <div class="form-group">
                    <label>è¯·ä¸ºæ‚¨çš„å® ç‰©é€‰æ‹©ä¸€ä¸ªå¯çˆ±çš„å¤´åƒï¼š</label>
                    <div class="avatar-selector">
                        <div class="avatar-option">
                            <input type="radio" id="avatar_dog1" name="avatar" value="dog1.png" 
                                {{ 'checked' if pet.avatar == 'dog1.png' else '' }} required>
                            <label for="avatar_dog1">
                                <img src="{{ url_for('static', filename='images/avatars/dog1.png') }}" alt="ç‹—å¤´åƒ1" class="avatar-img">
                                <span class="avatar-label">ç‹—ç‹—1</span>
                            </label>
                        </div>
                        <div class="avatar-option">
                            <input type="radio" id="avatar_dog2" name="avatar" value="dog2.png"
                                {{ 'checked' if pet.avatar == 'dog2.png' else '' }}>
                            <label for="avatar_dog2">
                                <img src="{{ url_for('static', filename='images/avatars/dog2.png') }}" alt="ç‹—å¤´åƒ2" class="avatar-img">
                                <span class="avatar-label">ç‹—ç‹—2</span>
                            </label>
                        </div>
                        <div class="avatar-option">
                            <input type="radio" id="avatar_dog3" name="avatar" value="dog3.png"
                                {{ 'checked' if pet.avatar == 'dog3.png' else '' }}>
                            <label for="avatar_dog3">
                                <img src="{{ url_for('static', filename='images/avatars/dog3.png') }}" alt="ç‹—å¤´åƒ3" class="avatar-img">
                                <span class="avatar-label">ç‹—ç‹—3</span>
                            </label>
                        </div>
                        <div class="avatar-option">
                            <input type="radio" id="avatar_dog4" name="avatar" value="dog4.png"
                                {{ 'checked' if pet.avatar == 'dog4.png' else '' }}>
                            <label for="avatar_dog4">
                                <img src="{{ url_for('static', filename='images/avatars/dog4.png') }}" alt="ç‹—å¤´åƒ4" class="avatar-img">
                                <span class="avatar-label">ç‹—ç‹—4</span>
                            </label>
                        </div>
                        <div class="avatar-option">
                            <input type="radio" id="avatar_cat1" name="avatar" value="cat1.png"
                                {{ 'checked' if pet.avatar == 'cat1.png' else '' }}>
                            <label for="avatar_cat1">
                                <img src="{{ url_for('static', filename='images/avatars/cat1.png') }}" alt="çŒ«å¤´åƒ1" class="avatar-img">
                                <span class="avatar-label">çŒ«çŒ«1</span>
                            </label>
                        </div>
                        <div class="avatar-option">
                            <input type="radio" id="avatar_cat2" name="avatar" value="cat2.png"
                                {{ 'checked' if pet.avatar == 'cat2.png' else '' }}>
                            <label for="avatar_cat2">
                                <img src="{{ url_for('static', filename='images/avatars/cat2.png') }}" alt="çŒ«å¤´åƒ2" class="avatar-img">
                                <span class="avatar-label">çŒ«çŒ«2</span>
                            </label>
                        </div>
                        <div class="avatar-option">
                            <input type="radio" id="avatar_cat3" name="avatar" value="cat3.png"
                                {{ 'checked' if pet.avatar == 'cat3.png' else '' }}>
                            <label for="avatar_cat3">
                                <img src="{{ url_for('static', filename='images/avatars/cat3.png') }}" alt="çŒ«å¤´åƒ3" class="avatar-img">
                                <span class="avatar-label">çŒ«çŒ«3</span>
                            </label>
                        </div>
                        <div class="avatar-option">
                            <input type="radio" id="avatar_cat4" name="avatar" value="cat4.png"
                                {{ 'checked' if pet.avatar == 'cat4.png' else '' }}>
                            <label for="avatar_cat4">
                                <img src="{{ url_for('static', filename='images/avatars/cat4.png') }}" alt="çŒ«å¤´åƒ4" class="avatar-img">
                                <span class="avatar-label">çŒ«çŒ«4</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <button type="submit" class="submit-btn">ğŸ’¾ ä¿å­˜ä¿®æ”¹</button>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // å¤„ç†"æ— ç‰¹æ®Šéœ€æ±‚"çš„äº’æ–¥é€»è¾‘
        const noneCheckbox = document.getElementById('need_none');
        const otherCheckboxes = document.querySelectorAll('input[name="special_needs"]:not(#need_none)');
        
        // å½“é€‰æ‹©"æ— ç‰¹æ®Šéœ€æ±‚"æ—¶ï¼Œå–æ¶ˆå…¶ä»–é€‰é¡¹
        noneCheckbox.addEventListener('change', function() {
            if (this.checked) {
                otherCheckboxes.forEach(cb => {
                    cb.checked = false;
                });
            }
        });
        
        // å½“é€‰æ‹©å…¶ä»–é€‰é¡¹æ—¶ï¼Œå–æ¶ˆ"æ— ç‰¹æ®Šéœ€æ±‚"
        otherCheckboxes.forEach(cb => {
            cb.addEventListener('change', function() {
                if (this.checked) {
                    noneCheckbox.checked = false;
                }
            });
        });
    });
</script>

{% endblock %}